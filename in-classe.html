<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>In Classe</title>
  <style>
    /* Theme variables and two visual variants - scoped to this file so we only change in-classe.html */
    :root{
      --bg: #130f14;
      --surface: #1b151b;
      --text: #f4eefe;
      --muted: #bdb0c3;
      --accent: #CFA8FF;
      --accent-strong: #b788ff;
      --radius-lg: 28px;
      --hit: 44px;
      --gap: 16px;
    }

    /* Variant 1 - default (coherent with Home) */
    .variant-default { --accent: #CFA8FF; --accent-strong: #b788ff; --gap:16px; }

    /* Variant 2 - higher contrast alternate */
    .variant-contrast { --accent: #FFD48A; --accent-strong: #ffb86b; --gap:12px; }

    body{ background: var(--bg); color:var(--text); font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial; margin:0; }
    .page{ max-width:920px; margin:0 auto; padding:20px; }
    header.h{ text-align:center; padding:18px 8px; }
    header.h h1{ margin:0; font-size:1.6rem; font-weight:700; }
    header.h p{ margin:8px 0 0; color:var(--muted); }

    /* Lesson card list - minimal, non-invasive */
    .lesson-card{ background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:12px; padding:16px; margin:18px 0; border:1px solid rgba(255,255,255,0.03); }
    .lesson-title{ font-size:1.25rem; font-weight:800; margin:8px 0; }
    .lesson-meta{ color:var(--muted); display:flex; flex-direction:column; gap:8px; font-size:0.98rem; }

    /* Buttons */
    .btn{ min-height:var(--hit); display:inline-flex; align-items:center; gap:10px; padding:10px 18px; border-radius:999px; font-weight:600; cursor:pointer; border:none; }
    .btn-primary{ background:var(--accent); color:#1a0f1a; box-shadow:0 6px 16px rgba(0,0,0,0.45); }
    .btn-secondary{ background:transparent; color:var(--accent); border:2px solid rgba(207,168,255,0.18); }

    /* Floating action button */
    .fab{ position: fixed; right:18px; bottom:18px; width:64px; height:64px; border-radius:50%; display:flex; align-items:center; justify-content:center; background:var(--accent-strong); color:var(--text); z-index:1000; box-shadow:0 12px 30px rgba(0,0,0,0.6); }

    /* Drawer styles (scoped, file-only change) */
    .lesson-drawer-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:1100; display:none; align-items:flex-end; justify-content:center; }
    .lesson-drawer{ width:100%; max-width:760px; background:linear-gradient(180deg,var(--surface), #231824); border-top-left-radius:var(--radius-lg); border-top-right-radius:var(--radius-lg); padding:20px; box-shadow:0 8px 24px rgba(11,7,15,0.6); max-height:86vh; overflow:auto; position:relative; }
    .drawer-close{ position:absolute; right:14px; top:12px; background:transparent; border:2px solid rgba(255,255,255,0.06); color:var(--text); width:40px; height:40px; border-radius:8px; }

    .drawer-header{ padding-bottom:8px; border-bottom:1px solid rgba(255,255,255,0.03); }
    .drawer-footer{ display:flex; gap:12px; margin-top:16px; }

    /* Accessibility focus */
    button:focus, .btn:focus{ outline:3px solid rgba(207,168,255,0.24); outline-offset:3px; }

    /* Variant UI helper controls (small panel) */
    .variants-panel{ position:fixed; left:18px; bottom:18px; z-index:1200; display:flex; gap:8px; background:rgba(0,0,0,0.35); padding:8px; border-radius:12px; }
    .variants-panel button{ padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.03); color:var(--text); border:1px solid rgba(255,255,255,0.04); font-size:0.9rem; }

    @media(min-width:900px){ .lesson-drawer-backdrop{ align-items:flex-start; justify-content:flex-end; } .lesson-drawer{ width:420px; border-radius:12px; top:120px; right:28px; position:fixed; } }
  </style>
</head>
<body class="variant-default">
  <div class="page">
    <header class="h">
      <h1>In Classe</h1>
      <p>Esplora e iscriviti alle lezioni disponibili</p>
    </header>

    <!-- Filter (kept minimal) -->
    <div>
      <label for="materia">Materia</label>
      <select id="materia">
        <option>Tutte le materie</option>
      </select>
    </div>

    <!-- Example lesson list (kept simple) -->
    <div class="lesson-card" data-lesson-id="1">
      <div class="lesson-meta">Teoria ‚Ä¢ Matematica</div>
      <div class="lesson-title">Introduzione all'Algebra Lineare</div>
      <div class="lesson-meta">
        <div>üë§ Prof. Mario Rossi</div>
        <div>üë• Classe 3A</div>
        <div>‚è± 08:00 - 09:00 (60 min)</div>
        <div>üìÖ luned√¨ 20 ottobre</div>
        <div style="font-weight:700">18 / 25 iscritti</div>
      </div>
      <div style="margin-top:12px; display:flex; gap:12px; align-items:center;">
        <button class="btn btn-secondary" onclick="openDrawer(1)">‚ÑπÔ∏è Dettagli</button>
        <button class="btn btn-primary" onclick="subscribe(1)">‚ûï Iscriviti</button>
      </div>
    </div>

    <div class="lesson-card" data-lesson-id="2">
      <div class="lesson-meta">Laboratorio ‚Ä¢ Scienze</div>
      <div class="lesson-title">Esperimenti di Chimica Organica</div>
      <div class="lesson-meta">
        <div>üë§ Prof.ssa Laura Bianchi</div>
        <div>üë• Classe 4B</div>
        <div>‚è± 10:00 - 12:00 (120 min)</div>
        <div>üìÖ luned√¨ 20 ottobre</div>
        <div style="font-weight:700">15 / 20 iscritti</div>
      </div>
      <div style="margin-top:12px; display:flex; gap:12px; align-items:center;">
        <button class="btn btn-secondary" onclick="openDrawer(2)">‚ÑπÔ∏è Dettagli</button>
        <button class="btn btn-primary" onclick="subscribe(2)">‚ûï Iscriviti</button>
      </div>
    </div>

    <!-- Lesson Details Drawer -->
    <div class="lesson-drawer-backdrop" id="lesson-drawer-backdrop" aria-hidden="true"></div>
    <aside class="lesson-drawer" id="lesson-drawer" role="dialog" aria-modal="true" aria-labelledby="drawer-title" aria-hidden="true">
        <div class="lesson-drawer-header">
            <div class="lesson-drawer-handle"></div>
            <button class="drawer-close" id="drawer-close" aria-label="Chiudi dettagli lezione">
                <span class="material-symbols-outlined">close</span>
            </button>
            <h3 class="lesson-drawer-title" id="drawer-title">Dettagli Lezione</h3>
            <div class="lesson-drawer-meta" id="drawer-meta">
                <span class="icon-label">
                    <span class="material-symbols-outlined">schedule</span>
                    <span id="drawer-time">08:00 - 09:00</span>
                </span>
                <span class="icon-label">
                    <span class="material-symbols-outlined">room</span>
                    <span id="drawer-room">Aula 101</span>
                </span>
                <span class="icon-label">
                    <span class="material-symbols-outlined">groups</span>
                    <span id="drawer-class">5A</span>
                </span>
            </div>
        </div>
        
        <div class="lesson-drawer-content">
            <div class="lesson-drawer-section">
                <h4>
                    <span class="material-symbols-outlined">info</span>
                    Informazioni
                </h4>
                <div class="icon-label">
                    <span class="material-symbols-outlined">book</span>
                    <span id="drawer-subject">Materia</span>
                </div>
                <p id="drawer-description" style="margin-top: var(--spacing-sm); color: var(--md-text-secondary);">
                    Descrizione della lezione
                </p>
            </div>
            
            <div class="lesson-drawer-section">
                <h4>
                    <span class="material-symbols-outlined">assignment</span>
                    Attivit√†
                </h4>
                <div id="drawer-activities">
                    <p style="color: var(--md-text-secondary); font-size: var(--font-size-sm);">
                        Nessuna attivit√† programmata
                    </p>
                </div>
            </div>
        </div>
        
        <div class="lesson-drawer-footer">
            <button class="btn btn-secondary" id="drawer-details-btn" style="flex: 1;">
                <span class="material-symbols-outlined">open_in_new</span>
                Dettagli
            </button>
            <button class="btn btn-primary" id="drawer-join-btn" style="flex: 1;">
                <span class="material-symbols-outlined">login</span>
                Iscriviti
            </button>
        </div>
    </aside>

    <!-- Scripts -->
    <script src="js/icons.js"></script>
    <script src="js/schedule-patch.js"></script>
    <script type="module">
        // Import centralized theme system
        import themeProvider from './src/components/ThemeProvider.js';
        import { validatePageTheme } from './src/utils/ThemeValidator.js';
        import { initializeTheme, setupThemePicker } from './js/theme.js';
        
        // Initialize ThemeProvider (centralized theme management)
        themeProvider.initialize();
        
        // Also initialize legacy theme system for backwards compatibility
        initializeTheme();
        
        // Validate theme setup
        validatePageTheme('in-classe');
        
        // Import floating assistant
        import { initFloatingAssistant } from './js/floating-assistant.js';
        window.initFloatingAssistant = initFloatingAssistant;
        
        // Import and initialize DailyTimeline
        import { initDailyTimeline } from './src/components/DailyTimeline.js';
        
        // Initialize DailyTimeline on page load
        document.addEventListener('DOMContentLoaded', () => {
            const timeline = initDailyTimeline('daily-timeline', new Date(), (lesson) => {
                console.log('Lesson clicked:', lesson);
                // Navigate to lesson if needed
                if (lesson.id) {
                    window.location.href = `in-classe.html?lesson=${encodeURIComponent(lesson.id)}`;
                }
            });
            window.dailyTimeline = timeline;
        });
        
        // Make themeProvider available globally for debugging
        window.themeProvider = themeProvider;
    </script>
    <script type="module" src="js/in-classe.js"></script>
    <script src="js/schedule-enhance.js"></script>

    <!-- Drawer Control Script -->
    <script>
        // Lesson Drawer Functions
        function openDrawer(lessonData) {
            const drawer = document.getElementById('lesson-drawer');
            const backdrop = document.getElementById('lesson-drawer-backdrop');
            
            if (!drawer || !backdrop) return;
            
            // Populate drawer with lesson data if provided
            if (lessonData) {
                const title = document.getElementById('drawer-title');
                const time = document.getElementById('drawer-time');
                const room = document.getElementById('drawer-room');
                const classEl = document.getElementById('drawer-class');
                const subject = document.getElementById('drawer-subject');
                const description = document.getElementById('drawer-description');
                
                if (title && lessonData.title) title.textContent = lessonData.title;
                if (time && lessonData.time) time.textContent = lessonData.time;
                if (room && lessonData.room) room.textContent = lessonData.room;
                if (classEl && lessonData.class) classEl.textContent = lessonData.class;
                if (subject && lessonData.subject) subject.textContent = lessonData.subject;
                if (description && lessonData.description) description.textContent = lessonData.description;
            }
            
            // Show drawer
            backdrop.classList.add('active');
            drawer.classList.add('active');
            backdrop.setAttribute('aria-hidden', 'false');
            drawer.setAttribute('aria-hidden', 'false');
            document.body.classList.add('drawer-open');
            
            // Focus first interactive element
            const closeBtn = document.getElementById('drawer-close');
            if (closeBtn) closeBtn.focus();
        }
        
        function closeDrawer() {
            const drawer = document.getElementById('lesson-drawer');
            const backdrop = document.getElementById('lesson-drawer-backdrop');
            
            if (!drawer || !backdrop) return;
            
            backdrop.classList.remove('active');
            drawer.classList.remove('active');
            backdrop.setAttribute('aria-hidden', 'true');
            drawer.setAttribute('aria-hidden', 'true');
            document.body.classList.remove('drawer-open');
        }
        
        // Initialize drawer controls
        document.addEventListener('DOMContentLoaded', () => {
            const closeBtn = document.getElementById('drawer-close');
            const backdrop = document.getElementById('lesson-drawer-backdrop');
            const detailsBtn = document.getElementById('drawer-details-btn');
            const joinBtn = document.getElementById('drawer-join-btn');
            
            // Close button
            if (closeBtn) {
                closeBtn.addEventListener('click', closeDrawer);
            }
            
            // Backdrop click to close
            if (backdrop) {
                backdrop.addEventListener('click', closeDrawer);
            }
            
            // Escape key to close
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    closeDrawer();
                }
            });
            
            // Demo: Open drawer when clicking lesson cards (you can customize this)
            // Uncomment and customize as needed:
            /*
            document.querySelectorAll('.lesson-card, .daily-timeline-item').forEach(card => {
                card.addEventListener('click', (e) => {
                    // Prevent opening if clicking a button inside
                    if (e.target.closest('button')) return;
                    
                    // Extract lesson data from card
                    const lessonData = {
                        title: card.querySelector('h4')?.textContent || 'Lezione',
                        time: card.querySelector('.timeline-time strong')?.textContent || '08:00 - 09:00',
                        subject: 'Materia',
                        class: '5A',
                        room: 'Aula 101',
                        description: 'Descrizione della lezione'
                    };
                    
                    openDrawer(lessonData);
                });
            });
            */
            
            // Placeholder actions for drawer buttons
            if (detailsBtn) {
                detailsBtn.addEventListener('click', () => {
                    console.log('Opening lesson details...');
                    // Add your details navigation logic here
                });
            }
            
            if (joinBtn) {
                joinBtn.addEventListener('click', () => {
                    console.log('Joining lesson...');
                    // Add your join lesson logic here
                });
            }
        });
        
        // Make functions globally available
        window.openDrawer = openDrawer;
        window.closeDrawer = closeDrawer;
    </script>

    <!-- AI Agent Floating Action Button (FAB) -->
    <button id="ai-fab" class="ai-fab" title="Apri Assistente IA" aria-label="Apri Assistente IA">
        <span class="material-symbols-outlined">smart_toy</span>
    </button>
</body>
</html>
