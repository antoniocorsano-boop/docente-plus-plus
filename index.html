<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web app per la gestione della didattica dell'insegnante potenziata da IA OpenRouter">
    <meta name="theme-color" content="#4a90e2">
    <title>Docente++ - Gestione Didattica con IA</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons for iOS -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Docente++">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="192x192" href="icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icons/icon-512x512.png">
    
    <!-- Material Design Icons -->
    <link href="fonts/material-icons.css" rel="stylesheet">
    <!-- Roboto Font -->
    <link href="fonts/roboto.css" rel="stylesheet">
    
    <link rel="stylesheet" href="styles.css">
    <!-- PDF and Excel Export Libraries -->
    <script src="libs/jspdf.umd.min.js"></script>
    <script src="libs/jspdf.plugin.autotable.min.js"></script>
    <script src="libs/xlsx.full.min.js"></script>
    <!-- PapaParse for CSV parsing -->
    <script src="libs/papaparse.min.js"></script>
    <!-- PDF.js for PDF text extraction -->
    <script src="libs/pdf.min.js"></script>
    <!-- RSS Parser for RSS/Atom feeds -->
    <script src="libs/rss-parser.min.js"></script>
    <!-- JSZip for backup ZIP creation -->
    <script src="libs/jszip.min.js"></script>
</head>
<body>
    <!-- Onboarding Modal -->
    <div id="onboarding-modal" class="modal" style="display: none;">
        <div class="modal-content onboarding-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">school</span>Benvenuto in Docente++</h2>
            <p class="onboarding-intro">Configura il tuo profilo per iniziare</p>
            
            <form id="onboarding-form">
                <div class="onboarding-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">person</span>Dati Personali</h3>
                    <div class="form-group">
                        <label for="onboarding-first-name">Nome: *</label>
                        <input type="text" id="onboarding-first-name" required>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-last-name">Cognome: *</label>
                        <input type="text" id="onboarding-last-name" required>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-email">Email: *</label>
                        <input type="email" id="onboarding-email" required>
                    </div>
                </div>

                <div class="onboarding-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">apartment</span>Informazioni Scolastiche</h3>
                    <div class="form-group">
                        <label for="onboarding-school-level">Ordine di Scuola: *</label>
                        <select id="onboarding-school-level" required>
                            <option value="">Seleziona ordine di scuola</option>
                            <option value="infanzia">Scuola dell'Infanzia</option>
                            <option value="primaria">Scuola Primaria</option>
                            <option value="secondaria-I">Scuola Secondaria di I Grado</option>
                            <option value="secondaria-II">Scuola Secondaria di II Grado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-school-name">Nome Scuola:</label>
                        <input type="text" id="onboarding-school-name" placeholder="Nome dell'istituto">
                    </div>
                </div>

                <div class="onboarding-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">menu_book</span>Discipline</h3>
                    <div class="form-group">
                        <label for="onboarding-subjects">Seleziona o inserisci le tue discipline:</label>
                        <div class="subjects-container">
                            <div id="selected-subjects-display" class="selected-subjects"></div>
                            <input type="text" id="onboarding-subjects" placeholder="Scrivi una disciplina e premi Invio">
                            <div id="subjects-suggestions" class="subjects-suggestions"></div>
                        </div>
                        <small>Premi Invio o seleziona dalla lista per aggiungere una disciplina</small>
                    </div>
                </div>

                <div class="onboarding-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">calendar_today</span>Anno Scolastico</h3>
                    <div class="form-group">
                        <label for="onboarding-school-year">Anno Scolastico: *</label>
                        <select id="onboarding-school-year" required>
                            <option value="">Seleziona anno scolastico</option>
                            <option value="2024/2025">2024/2025</option>
                            <option value="2025/2026">2025/2026</option>
                            <option value="2026/2027">2026/2027</option>
                            <option value="2027/2028">2027/2028</option>
                            <option value="2028/2029">2028/2029</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="onboarding-year-start">Data Inizio Anno:</label>
                        <input type="date" id="onboarding-year-start" value="2025-09-09">
                    </div>
                    <div class="form-group">
                        <label for="onboarding-year-end">Data Fine Anno:</label>
                        <input type="date" id="onboarding-year-end" value="2026-06-30">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="submit" class="btn btn-primary">Inizia ad Usare Docente++</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Export Format Selection Modal -->
    <div id="export-format-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <h2>ðŸ“¥ Seleziona Formato di Esportazione</h2>
            <p id="export-description">Scegli il formato in cui desideri esportare i dati:</p>
            
            <div class="export-format-options">
                <div class="format-option" onclick="app.executeExport('json')">
                    <div class="format-icon material-icons">description</div>
                    <h3>JSON</h3>
                    <p>Formato dati strutturato, ideale per backup e importazione</p>
                </div>
                <div class="format-option" onclick="app.executeExport('pdf')">
                    <div class="format-icon">ðŸ“•</div>
                    <h3>PDF</h3>
                    <p>Documento formattato pronto per la stampa e condivisione</p>
                </div>
                <div class="format-option" onclick="app.executeExport('excel')">
                    <div class="format-icon material-icons">table_chart</div>
                    <h3>Excel</h3>
                    <p>Foglio di calcolo per analisi avanzate (XLSX)</p>
                </div>
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeExportModal()">Annulla</button>
            </div>
        </div>
    </div>

    <div class="container">
        <header>
            <h1><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">school</span>Docente++</h1>
            <p class="subtitle">Gestione Didattica Potenziata da IA</p>
        </header>

        <!-- Active Class Badge (persistent, always visible) -->
        <div class="active-class-badge" id="active-class-badge" onclick="app.showClassSelector()">
            <span class="badge-icon">ðŸŽ¯</span>
            <span class="badge-text" id="active-class-badge-text">Workspace</span>
        </div>

        <div class="nav-container">
            <button class="menu-toggle" id="menu-toggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
            <nav class="tabs" id="main-nav" role="navigation" aria-label="Menu principale">
                <!-- Sala Prof (Dashboard/Workspace) -->
                <button class="tab-button active" data-tab="home" title="Sala Prof - Dashboard Workspace" aria-label="Sala Prof">
                    <span class="menu-icon material-icons">home</span>
                    <span class="menu-text">Sala Prof</span>
                </button>
                
                <!-- Classe (Class Selection - opens modal) -->
                <button class="tab-button" data-tab="class-selector" title="Seleziona Classe Attiva" aria-label="Classe" onclick="app.showClassSelector()">
                    <span class="menu-icon material-icons">school</span>
                    <span class="menu-text">Classe</span>
                </button>
                
                <!-- Gestione (Operational Features) -->
                <div class="menu-group compact-menu">
                    <button class="tab-button menu-with-submenu" title="Gestione - FunzionalitÃ  operative" aria-label="Gestione" aria-expanded="false">
                        <span class="menu-icon material-icons">apps</span>
                        <span class="menu-text">Gestione</span>
                        <span class="menu-arrow">â–¼</span>
                    </button>
                    <div class="submenu" role="menu">
                        <button class="tab-button submenu-item" data-tab="students" title="Gestione Studenti" aria-label="Studenti">
                            <span class="menu-icon material-icons">person</span>
                            <span class="menu-text">Studenti</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="classes" title="Gestione Classi" aria-label="Classi">
                            <span class="menu-icon material-icons">school</span>
                            <span class="menu-text">Classi</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="lessons" title="Gestione Lezioni" aria-label="Lezioni">
                            <span class="menu-icon material-icons">menu_book</span>
                            <span class="menu-text">Lezioni</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="schedule" title="Orario Settimanale" aria-label="Orario">
                            <span class="menu-icon material-icons">calendar_today</span>
                            <span class="menu-text">Orario</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="evaluations" title="Valutazioni" aria-label="Valutazioni">
                            <span class="menu-icon material-icons">grading</span>
                            <span class="menu-text">Valutazioni</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="activities" title="AttivitÃ  Didattiche" aria-label="AttivitÃ ">
                            <span class="menu-icon material-icons">assignment</span>
                            <span class="menu-text">AttivitÃ </span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="ai-assistant" title="Assistente IA" aria-label="IA">
                            <span class="menu-icon material-icons">smart_toy</span>
                            <span class="menu-text">Assistente IA</span>
                        </button>
                    </div>
                </div>
                
                <!-- Impostazioni (Settings & Backup) -->
                <div class="menu-group compact-menu">
                    <button class="tab-button menu-with-submenu" title="Impostazioni - Configurazione e Backup" aria-label="Impostazioni" aria-expanded="false">
                        <span class="menu-icon material-icons">settings</span>
                        <span class="menu-text">Impostazioni</span>
                        <span class="menu-arrow">â–¼</span>
                    </button>
                    <div class="submenu" role="menu">
                        <button class="tab-button submenu-item" data-tab="settings" title="Configurazione App" aria-label="Config">
                            <span class="menu-icon material-icons">settings</span>
                            <span class="menu-text">Configurazione</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="backup-restore" title="Backup e Ripristino" aria-label="Backup">
                            <span class="menu-icon material-icons">backup</span>
                            <span class="menu-text">Backup</span>
                        </button>
                        <button class="tab-button submenu-item" data-tab="notifications" title="Notifiche e Promemoria" aria-label="Notifiche">
                            <span class="menu-icon material-icons">notifications</span>
                            <span class="menu-text">Notifiche</span>
                        </button>
                    </div>
                </div>
                
                <!-- Info App -->
                <button class="tab-button" data-tab="info-app" title="Informazioni sull'App" aria-label="Info App">
                    <span class="menu-icon material-icons">info</span>
                    <span class="menu-text">Info</span>
                </button>
                
                <!-- Guida (Help) -->
                <button class="tab-button" data-tab="help" title="Guida e Documentazione" aria-label="Guida">
                    <span class="menu-icon material-icons">help</span>
                    <span class="menu-text">Guida</span>
                </button>
            </nav>
        </div>
        
        <div class="menu-backdrop" id="menu-backdrop"></div>

        <!-- Home Tab (Sala Prof) -->
        <div id="home" class="tab-content active">
            <div class="tab-header">
                <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">home</span>Sala Prof</h2>
                <button class="help-btn" onclick="app.showContextualHelp('home')" title="Aiuto" aria-label="Aiuto">?</button>
            </div>
            
            <!-- Enhanced Today's Schedule Section -->
            <div class="home-section schedule-section">
                <div class="section-header-flex">
                    <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">calendar_today</span>Orario di Oggi</h2>
                    <div class="schedule-actions">
                        <button class="btn btn-sm btn-secondary" onclick="app.goToTodaySchedule()" title="Vista completa orario" aria-label="Orario completo">
                            <span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">assignment</span>Completo
                        </button>
                    </div>
                </div>
                <div id="today-schedule-enhanced" class="schedule-today-grid">
                    <!-- Will be populated by renderTodayScheduleEnhanced() -->
                </div>
                <p class="schedule-info-text">
                    <small><span class="material-icons" style="vertical-align: middle; font-size: 16px;">lightbulb</span> Tocca una cella per modificare l'attivitÃ . 
                    <span id="schedule-filter-info">Mostrando: <strong id="schedule-class-name">Workspace (tutte le classi)</strong></span>
                    </small>
                </p>
            </div>

            <!-- Quick Access Section -->
            <div class="home-section">
                <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">bolt</span>Accesso Rapido</h2>
                <div class="home-quick-access">
                    <button class="btn-quick-access" onclick="app.switchTab('lessons')">
                        <span class="quick-icon material-icons">menu_book</span>
                        <span class="quick-label">Lezioni</span>
                        <span class="quick-count" id="home-lesson-count">0</span>
                    </button>
                    <button class="btn-quick-access" onclick="app.switchTab('students')">
                        <span class="quick-icon material-icons">groups</span>
                        <span class="quick-label">Studenti</span>
                        <span class="quick-count" id="home-student-count">0</span>
                    </button>
                    <button class="btn-quick-access" onclick="app.switchTab('activities')">
                        <span class="quick-icon material-icons">assignment</span>
                        <span class="quick-label">AttivitÃ </span>
                        <span class="quick-count" id="home-activity-count">0</span>
                    </button>
                    <button class="btn-quick-access" onclick="app.switchTab('evaluations')">
                        <span class="quick-icon material-icons">grading</span>
                        <span class="quick-label">Valutazioni</span>
                        <span class="quick-count" id="home-evaluation-count">0</span>
                    </button>
                </div>
            </div>
            
            <!-- Things To Do Section -->
            <div class="home-section">
                <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">check_circle</span>Cose da Fare</h2>
                <div id="things-todo-list"></div>
            </div>
            
            <!-- AI Suggestions Section -->
            <div class="home-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2 style="margin: 0;"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">smart_toy</span>Suggerimenti IA</h2>
                    <button class="btn btn-sm btn-secondary" onclick="app.refreshAISuggestions()" title="Aggiorna suggerimenti">
                        <span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">refresh</span>Aggiorna
                    </button>
                </div>
                <div id="ai-suggestions-content"></div>
            </div>

            <!-- Notifications and Reminders Section -->
            <div class="home-section">
                <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">notifications</span>Notifiche e Promemoria</h2>
                <div id="home-notifications-preview">
                    <p class="home-placeholder">Nessuna notifica per oggi</p>
                </div>
                <button class="btn btn-secondary" onclick="app.switchTab('notifications')" style="margin-top: 10px;">
                    Vedi tutte le notifiche
                </button>
            </div>

            <!-- AI Assistant Quick Access -->
            <div class="home-section">
                <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">smart_toy</span>Assistente IA</h2>
                <p id="home-ai-status">Stato IA: <span id="home-ai-ready">Non configurata</span></p>
                <div class="home-ai-actions">
                    <button class="btn btn-primary" onclick="app.switchTab('ai-assistant')">
                        <span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">chat</span>Apri Assistente IA
                    </button>
                    <button class="btn btn-secondary" onclick="app.switchTab('document-import')">
                        <span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">description</span>Importa Documenti con IA
                    </button>
                </div>
            </div>
        </div>

        <!-- Lessons Tab -->
        <div id="lessons" class="tab-content">
            <div class="tab-header">
                <h2>Gestione Lezioni</h2>
                <button class="help-btn" onclick="app.showContextualHelp('lessons')" title="Aiuto">?</button>
            </div>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddLessonForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuova Lezione</button>
                <button class="btn btn-secondary" onclick="app.generateLessonWithAI()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">smart_toy</span>Genera con IA</button>
            </div>
            
            <div id="add-lesson-form" class="form-container" style="display: none;">
                <h3>Nuova Lezione</h3>
                <form id="lesson-form">
                    <div class="form-group">
                        <label for="lesson-title">Titolo:</label>
                        <input type="text" id="lesson-title" required>
                    </div>
                    <div class="form-group">
                        <label for="lesson-subject">Materia:</label>
                        <input type="text" id="lesson-subject" required>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="lesson-date">Data:</label>
                            <input type="date" id="lesson-date" required>
                        </div>
                        <div class="form-group">
                            <label for="lesson-time">Ora:</label>
                            <input type="time" id="lesson-time" value="09:00" required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="lesson-description">Descrizione:</label>
                        <textarea id="lesson-description" rows="4"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddLessonForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="lessons-list" class="lessons-list"></div>
        </div>

        <!-- Schedule Tab -->
        <div id="schedule" class="tab-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">calendar_today</span>Orario Didattico</h2>
            <div class="schedule-info">
                <p>Gestisci il tuo orario settimanale. Clicca su una cella per assegnare una classe e un tipo di attivitÃ  (Teoria, Disegno, Laboratorio).</p>
                <p><small>Gli slot orari vanno dalle 8:00 alle 14:00, dal lunedÃ¬ al venerdÃ¬. Sabato e domenica sono automaticamente esclusi.</small></p>
            </div>
            <div id="schedule-container"></div>
        </div>

        <!-- Activities Tab -->
        <div id="activities" class="tab-content">
            <h2>Gestione AttivitÃ  Didattiche</h2>
            
            <!-- Activities Summary Section -->
            <div id="activities-summary" class="summary-section" role="region" aria-label="Riepilogo statistiche attivitÃ ">
                <h3>Riepilogo AttivitÃ </h3>
                <div class="summary-cards" role="group" aria-label="Statistiche attivitÃ  didattiche">
                    <div class="summary-card">
                        <div class="summary-icon material-icons">assignment</div>
                        <div class="summary-content">
                            <p class="summary-number" id="total-activities">0</p>
                            <p class="summary-label">Totali</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon material-icons">event</div>
                        <div class="summary-content">
                            <p class="summary-number" id="planned-activities">0</p>
                            <p class="summary-label">Pianificate</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon material-icons">play_arrow</div>
                        <div class="summary-content">
                            <p class="summary-number" id="inprogress-activities">0</p>
                            <p class="summary-label">In Corso</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon material-icons">check_circle</div>
                        <div class="summary-content">
                            <p class="summary-number" id="completed-activities">0</p>
                            <p class="summary-label">Completate</p>
                        </div>
                    </div>
                    <div class="summary-card">
                        <div class="summary-icon material-icons">warning</div>
                        <div class="summary-content">
                            <p class="summary-number" id="overdue-activities">0</p>
                            <p class="summary-label">Scadute</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddActivityForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuova AttivitÃ </button>
                <select id="activity-filter" class="filter-select" onchange="app.renderActivities()">
                    <option value="all">Tutte le attivitÃ </option>
                    <option value="planned">Pianificate</option>
                    <option value="in-progress">In corso</option>
                    <option value="completed">Completate</option>
                    <option value="lesson">Lezioni</option>
                    <option value="exercise">Esercitazioni</option>
                    <option value="lab">Laboratori</option>
                    <option value="project">Progetti</option>
                    <option value="homework">Compiti</option>
                    <option value="exam">Verifiche</option>
                </select>
            </div>
            
            <div id="add-activity-form" class="form-container" style="display: none;">
                <h3 id="activity-form-title">Nuova AttivitÃ </h3>
                <form id="activity-form">
                    <input type="hidden" id="activity-edit-id">
                    <div class="form-group">
                        <label for="activity-title">Titolo: *</label>
                        <input type="text" id="activity-title" required>
                    </div>
                    <div class="form-group">
                        <label for="activity-type">Tipo di AttivitÃ : *</label>
                        <select id="activity-type" required>
                            <option value="lesson">Lezione</option>
                            <option value="exercise">Esercitazione</option>
                            <option value="lab">Laboratorio</option>
                            <option value="project">Progetto</option>
                            <option value="homework">Compiti</option>
                            <option value="exam">Verifica</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-priority">PrioritÃ :</label>
                        <select id="activity-priority">
                            <option value="low">Bassa</option>
                            <option value="medium" selected>Media</option>
                            <option value="high">Alta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-description">Descrizione:</label>
                        <textarea id="activity-description" rows="4"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="activity-deadline">Scadenza:</label>
                        <input type="date" id="activity-deadline">
                    </div>
                    <div class="form-group">
                        <label for="activity-progress">Avanzamento (%):</label>
                        <input type="number" id="activity-progress" min="0" max="100" value="0">
                        <small>Percentuale di completamento dell'attivitÃ  (0-100)</small>
                    </div>
                    <div class="form-group">
                        <label for="activity-class">Assegna a Classe:</label>
                        <select id="activity-class">
                            <option value="">Nessuna (generale)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-student">Assegna a Studente:</label>
                        <select id="activity-student">
                            <option value="">Nessuno (tutta la classe)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="activity-notes">Note/Feedback:</label>
                        <textarea id="activity-notes" rows="3" placeholder="Aggiungi note o feedback sull'attivitÃ "></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddActivityForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="activities-list" class="activities-list"></div>
        </div>

        <!-- Students Tab -->
        <div id="students" class="tab-content">
            <div class="tab-header">
                <h2>Gestione Studenti</h2>
                <button class="help-btn" onclick="app.showContextualHelp('students')" title="Aiuto">?</button>
            </div>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddStudentForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuovo Studente</button>
                <button class="btn btn-secondary" onclick="app.showImportStudentsDialog()">ðŸ“¥ Importa da File</button>
            </div>
            
            <div id="add-student-form" class="form-container" style="display: none;">
                <h3>Nuovo Studente</h3>
                <form id="student-form">
                    <div class="form-group">
                        <label for="student-name">Nome e Cognome:</label>
                        <input type="text" id="student-name" required>
                    </div>
                    <div class="form-group">
                        <label for="student-email">Email:</label>
                        <input type="email" id="student-email">
                        <small id="student-email-validation" class="validation-message"></small>
                    </div>
                    <div class="form-group">
                        <label for="student-class">Classe:</label>
                        <input type="text" id="student-class">
                    </div>
                    <div class="form-group">
                        <label for="student-birthdate">Data di Nascita:</label>
                        <input type="date" id="student-birthdate">
                    </div>
                    <div class="form-group">
                        <label for="student-nameday">Onomastico/Santo:</label>
                        <input type="text" id="student-nameday" placeholder="es. San Giovanni - 24 Giugno">
                    </div>
                    <div class="form-group">
                        <label for="student-notes">Note:</label>
                        <textarea id="student-notes" rows="2" placeholder="Note aggiuntive sullo studente"></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddStudentForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="students-list" class="students-list"></div>
        </div>

        <!-- Classes Tab -->
        <div id="classes" class="tab-content">
            <div class="tab-header">
                <h2>Gestione Classi</h2>
                <button class="help-btn" onclick="app.showContextualHelp('classes')" title="Aiuto">?</button>
            </div>
            <div class="section-actions">
                <button class="btn btn-primary" onclick="app.showAddClassForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuova Classe</button>
            </div>
            
            <div id="add-class-form" class="form-container" style="display: none;">
                <h3 id="class-form-title">Nuova Classe</h3>
                <form id="class-form">
                    <input type="hidden" id="class-edit-id">
                    <div class="form-group">
                        <label for="class-name">Nome Classe: *</label>
                        <input type="text" id="class-name" placeholder="es. 1A, 2B, 3C" required>
                        <small>Inserisci il nome/sezione della classe</small>
                    </div>
                    <div class="form-group">
                        <label for="class-year">Anno di Corso:</label>
                        <select id="class-year">
                            <option value="">Seleziona anno</option>
                            <option value="1">1Â° Anno</option>
                            <option value="2">2Â° Anno</option>
                            <option value="3">3Â° Anno</option>
                            <option value="4">4Â° Anno</option>
                            <option value="5">5Â° Anno</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="class-section">Sezione:</label>
                        <input type="text" id="class-section" placeholder="es. A, B, C" maxlength="2">
                    </div>
                    <div class="form-group">
                        <label for="class-students-count">Numero Studenti:</label>
                        <input type="number" id="class-students-count" min="0" placeholder="es. 25">
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva</button>
                        <button type="button" class="btn btn-secondary" onclick="app.hideAddClassForm()">Annulla</button>
                    </div>
                </form>
            </div>

            <div id="classes-list" class="classes-list"></div>
        </div>

        <!-- Evaluations Tab -->
        <div id="evaluations" class="tab-content">
            <h2>Gestione Valutazioni</h2>
            
            <!-- Evaluation Criteria Section -->
            <div class="evaluation-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">assignment</span>Criteri di Valutazione</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddCriterionForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuovo Criterio</button>
                    <button class="btn btn-secondary" onclick="app.generateCriteriaWithAI()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">smart_toy</span>Genera con IA</button>
                </div>

                <div id="add-criterion-form" class="form-container" style="display: none;">
                    <h4>Nuovo Criterio di Valutazione</h4>
                    <form id="criterion-form" onsubmit="event.preventDefault(); app.addCriterion();">
                        <div class="form-group">
                            <label for="criterion-name">Nome Criterio: *</label>
                            <input type="text" id="criterion-name" placeholder="es. Comprensione del testo" required>
                        </div>
                        <div class="form-group">
                            <label for="criterion-description">Descrizione:</label>
                            <textarea id="criterion-description" rows="3" placeholder="Descrivi il criterio di valutazione"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="criterion-subject">Disciplina:</label>
                            <input type="text" id="criterion-subject" placeholder="es. Italiano">
                        </div>
                        <div class="form-group">
                            <label for="criterion-type">Tipo:</label>
                            <select id="criterion-type">
                                <option value="">Seleziona tipo</option>
                                <option value="conoscenza">Conoscenza</option>
                                <option value="competenza">Competenza</option>
                                <option value="abilitÃ ">AbilitÃ </option>
                                <option value="atteggiamento">Atteggiamento</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddCriterionForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="criteria-list" class="criteria-list"></div>
            </div>

            <!-- Evaluation Grids Section -->
            <div class="evaluation-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">table_chart</span>Griglie di Valutazione (Rubriche)</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddGridForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuova Griglia</button>
                </div>

                <div id="add-grid-form" class="form-container" style="display: none;">
                    <h4>Nuova Griglia di Valutazione</h4>
                    <form id="grid-form" onsubmit="event.preventDefault(); app.addGrid();">
                        <div class="form-group">
                            <label for="grid-name">Nome Griglia: *</label>
                            <input type="text" id="grid-name" placeholder="es. Rubrica di Italiano" required>
                        </div>
                        <div class="form-group">
                            <label for="grid-description">Descrizione:</label>
                            <textarea id="grid-description" rows="3" placeholder="Descrivi la griglia di valutazione"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="grid-subject">Disciplina:</label>
                            <input type="text" id="grid-subject" placeholder="es. Italiano">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddGridForm()">Annulla</button>
                        </div>
                        <small>Nota: La griglia sarÃ  creata con 4 livelli di default (Eccellente, Buono, Sufficiente, Insufficiente)</small>
                    </form>
                </div>

                <div id="grids-list" class="grids-list"></div>
            </div>

            <!-- Evaluations Section -->
            <div class="evaluation-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">grading</span>Valutazioni Assegnate</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddEvaluationForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuova Valutazione</button>
                    <button class="btn btn-secondary" onclick="app.exportEvaluations()">ðŸ“¥ Esporta Valutazioni</button>
                </div>

                <div id="add-evaluation-form" class="form-container" style="display: none;">
                    <h4>Nuova Valutazione</h4>
                    <form id="evaluation-form" onsubmit="event.preventDefault(); app.addEvaluation();">
                        <div class="form-group">
                            <label for="evaluation-student">Studente:</label>
                            <select id="evaluation-student">
                                <option value="">Seleziona studente</option>
                            </select>
                            <small>Oppure seleziona una classe qui sotto</small>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-class">Classe:</label>
                            <select id="evaluation-class">
                                <option value="">Seleziona classe</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-criterion">Criterio:</label>
                            <select id="evaluation-criterion">
                                <option value="">Seleziona criterio</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-grid">Griglia:</label>
                            <select id="evaluation-grid">
                                <option value="">Seleziona griglia</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-subject">Disciplina:</label>
                            <select id="evaluation-subject">
                                <option value="">Seleziona disciplina</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="evaluation-score">Voto (opzionale):</label>
                            <input type="number" id="evaluation-score" min="0" max="10" step="0.5" placeholder="es. 8">
                        </div>
                        <div class="form-group">
                            <label for="evaluation-date">Data:</label>
                            <input type="date" id="evaluation-date" value="">
                        </div>
                        <div class="form-group">
                            <label for="evaluation-notes">Note:</label>
                            <textarea id="evaluation-notes" rows="3" placeholder="Aggiungi note sulla valutazione"></textarea>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddEvaluationForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="evaluations-list" class="evaluations-list"></div>
            </div>

            <!-- Assessment Results and Analytics Section -->
            <div class="evaluation-section">
                <h3>ðŸ“ˆ Risultati e Statistiche</h3>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="app.toggleResultsView()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">sync</span>Cambia Visualizzazione</button>
                </div>

                <div id="results-filters" class="filters-container">
                    <div class="filter-group">
                        <label for="filter-class">Filtra per Classe:</label>
                        <select id="filter-class" onchange="app.filterResults()">
                            <option value="">Tutte le classi</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-subject">Filtra per Disciplina:</label>
                        <select id="filter-subject" onchange="app.filterResults()">
                            <option value="">Tutte le discipline</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="filter-student">Filtra per Studente:</label>
                        <select id="filter-student" onchange="app.filterResults()">
                            <option value="">Tutti gli studenti</option>
                        </select>
                    </div>
                </div>

                <div id="results-display" class="results-display"></div>
            </div>
        </div>

        <!-- News Tab -->
        <div id="news" class="tab-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">article</span>News e Feed RSS/Atom</h2>
            <p class="section-description">
                Gestisci le tue fonti RSS/Atom e visualizza le news. Usa l'agente IA per analizzare le news e creare automaticamente attivitÃ , scadenze e circolari.
            </p>

            <!-- RSS Feeds Management Section -->
            <div class="news-section">
                <h3>ðŸ“¡ Fonti RSS/Atom</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddFeedForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Aggiungi Fonte RSS</button>
                    <button class="btn btn-secondary" onclick="app.refreshAllFeeds()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">refresh</span>Aggiorna Tutte</button>
                </div>

                <div id="add-feed-form" class="form-container" style="display: none;">
                    <h4>Aggiungi Fonte RSS/Atom</h4>
                    <form onsubmit="event.preventDefault(); app.addRSSFeed();">
                        <div class="form-group">
                            <label for="feed-name">Nome Fonte: *</label>
                            <input type="text" id="feed-name" placeholder="es. MIUR - Notizie" required>
                        </div>
                        <div class="form-group">
                            <label for="feed-url">URL Feed RSS/Atom: *</label>
                            <input type="url" id="feed-url" placeholder="https://esempio.com/feed.xml" required>
                            <small>Inserisci l'URL del feed RSS o Atom</small>
                        </div>
                        <div class="form-group">
                            <label for="feed-category">Categoria:</label>
                            <select id="feed-category">
                                <option value="istituzionale">Istituzionale</option>
                                <option value="normativa">Normativa</option>
                                <option value="didattica">Didattica</option>
                                <option value="circolari">Circolari</option>
                                <option value="altro">Altro</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Aggiungi</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddFeedForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="feeds-list" class="feeds-list"></div>
            </div>

            <!-- News List Section -->
            <div class="news-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">feed</span>Ultime News</h3>
                <div class="section-actions">
                    <div class="filter-group">
                        <label for="news-filter-source">Filtra per fonte:</label>
                        <select id="news-filter-source" onchange="app.filterNews()">
                            <option value="">Tutte le fonti</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="news-filter-category">Filtra per categoria:</label>
                        <select id="news-filter-category" onchange="app.filterNews()">
                            <option value="">Tutte le categorie</option>
                            <option value="istituzionale">Istituzionale</option>
                            <option value="normativa">Normativa</option>
                            <option value="didattica">Didattica</option>
                            <option value="circolari">Circolari</option>
                            <option value="altro">Altro</option>
                        </select>
                    </div>
                </div>

                <div id="news-list" class="news-list"></div>
            </div>
        </div>

        <!-- AI Assistant Tab -->
        <div id="ai-assistant" class="tab-content">
            <h2>Assistente IA OpenRouter</h2>
            <div class="ai-container">
                <div class="ai-chat">
                    <div id="chat-messages" class="chat-messages"></div>
                    <div class="chat-file-upload">
                        <label for="ai-file-input" class="file-upload-label">
                            ðŸ“Ž Allega file (PDF, immagini, txt, ecc.)
                        </label>
                        <input type="file" id="ai-file-input" accept=".pdf,.jpg,.jpeg,.png,.txt,.doc,.docx" onchange="app.handleFileSelect(event)">
                        <div id="selected-file-display" class="selected-file-display"></div>
                    </div>
                    <div class="chat-input-container">
                        <textarea id="ai-input" placeholder="Chiedi all'assistente IA di aiutarti con la pianificazione delle lezioni, idee didattiche, valutazioni..." rows="3"></textarea>
                        <button class="btn btn-primary" onclick="app.sendAIMessage()">Invia</button>
                    </div>
                </div>
                <div class="ai-suggestions">
                    <h3>Suggerimenti Rapidi</h3>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Genera un piano di lezione per matematica')">ðŸ“ Piano lezione matematica</button>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Crea esercizi per italiano')">âœï¸ Esercizi italiano</button>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Suggerisci attivitÃ  didattiche interattive')">ðŸŽ¯ AttivitÃ  interattive</button>
                    <button class="suggestion-btn" onclick="app.quickAIPrompt('Genera criteri di valutazione')"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">table_chart</span>Criteri valutazione</button>
                </div>
            </div>
        </div>

        <!-- Notifications Tab -->
        <div id="notifications" class="tab-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">notifications</span>Notifiche e Promemoria</h2>
            
            <!-- Notifications Section -->
            <div class="notification-section">
                <div class="section-header" id="notifications-header">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">notifications_active</span>Notifiche Recenti</h3>
                </div>
                <div class="section-actions">
                    <button class="btn btn-secondary" onclick="app.markAllNotificationsRead()">âœ“ Segna tutte come lette</button>
                    <button class="btn btn-secondary" onclick="app.clearAllNotifications()">ðŸ—‘ï¸ Elimina tutte</button>
                </div>
                <!-- Filter section -->
                <div id="notifications-filter" class="notifications-filter"></div>
                <div id="notifications-list" class="notifications-list"></div>
            </div>

            <!-- Reminders Section -->
            <div class="reminder-section">
                <h3>â° Promemoria Personali</h3>
                <div class="section-actions">
                    <button class="btn btn-primary" onclick="app.showAddReminderForm()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">add</span>Nuovo Promemoria</button>
                </div>

                <div id="add-reminder-form" class="form-container" style="display: none;">
                    <h4>Crea Promemoria</h4>
                    <form onsubmit="event.preventDefault(); app.addReminder();">
                        <div class="form-group">
                            <label for="reminder-title">Titolo: *</label>
                            <input type="text" id="reminder-title" placeholder="Titolo del promemoria" required>
                        </div>
                        <div class="form-group">
                            <label for="reminder-message">Messaggio:</label>
                            <textarea id="reminder-message" placeholder="Descrizione del promemoria" rows="3"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="reminder-date">Data: *</label>
                                <input type="date" id="reminder-date" required>
                            </div>
                            <div class="form-group">
                                <label for="reminder-time">Ora: *</label>
                                <input type="time" id="reminder-time" required>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Salva Promemoria</button>
                            <button type="button" class="btn btn-secondary" onclick="app.hideAddReminderForm()">Annulla</button>
                        </div>
                    </form>
                </div>

                <div id="reminders-list" class="reminders-list"></div>
            </div>

            <!-- Notification Settings Section -->
            <div class="notification-settings-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">settings</span>Impostazioni Notifiche</h3>
                <form id="notification-settings-form" onsubmit="event.preventDefault(); app.saveNotificationSettings();">
                    <div class="settings-group">
                        <h4>Canali di Notifica</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-browser">
                                ðŸŒ Notifiche Browser
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-email" disabled>
                                ðŸ“§ Notifiche Email (prossimamente)
                            </label>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Promemoria Automatici</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-lesson-reminders">
                                <span class="material-icons" style="vertical-align: middle; font-size: 16px; margin-right: 4px;">menu_book</span>Promemoria per lezioni programmate
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-24h">
                                â° Avviso 24 ore prima della lezione
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-1h">
                                â° Avviso 1 ora prima della lezione
                            </label>
                        </div>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-backup-reminders">
                                <span class="material-icons" style="vertical-align: middle; font-size: 16px; margin-right: 4px;">backup</span>Promemoria backup periodici
                            </label>
                        </div>
                        <div class="form-group" style="margin-left: 25px;">
                            <label for="notification-backup-interval">Intervallo backup (giorni):</label>
                            <input type="number" id="notification-backup-interval" min="1" max="365" value="7" style="width: 100px;">
                            <small>Ricevi un promemoria ogni X giorni per eseguire un backup</small>
                        </div>
                    </div>

                    <div class="settings-group">
                        <h4>Orari Silenzio</h4>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" id="notification-quiet-hours">
                                ðŸŒ™ Abilita orari di silenzio
                            </label>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="notification-quiet-start">Inizio:</label>
                                <input type="time" id="notification-quiet-start">
                            </div>
                            <div class="form-group">
                                <label for="notification-quiet-end">Fine:</label>
                                <input type="time" id="notification-quiet-end">
                            </div>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary">Salva Impostazioni</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Document Import Tab -->
        <div id="document-import" class="tab-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">folder_open</span>Importazione e Gestione Documenti con IA</h2>
            <p class="section-description">
                Carica documenti didattici e anagrafici. L'assistente IA ti aiuterÃ  a riconoscere e importare automaticamente i dati.
            </p>

            <!-- Quick Upload Section -->
            <div class="document-upload-section">
                <h3>ðŸ“¤ Carica Documento</h3>
                <div class="upload-area" id="document-upload-area" onclick="document.getElementById('document-file-input').click()">
                    <div class="upload-icon">ðŸ“Ž</div>
                    <p><strong>Clicca per selezionare</strong> o trascina un file qui</p>
                    <p class="upload-formats">Formati supportati: CSV, XLSX, PDF, TXT, JSON</p>
                </div>
                <input type="file" id="document-file-input" accept=".csv,.xlsx,.xls,.pdf,.txt,.json" style="display: none;" onchange="app.handleDocumentUpload(event)">
                
                <div id="document-upload-status" class="upload-status" style="display: none;"></div>
            </div>

            <!-- AI Classification Section -->
            <div class="document-classification-section" id="document-classification" style="display: none;">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">smart_toy</span>Riconoscimento Automatico</h3>
                <div id="classification-result" class="classification-result"></div>
                <div id="classification-actions" class="classification-actions"></div>
            </div>

            <!-- Import Preview Section -->
            <div class="document-preview-section" id="document-preview" style="display: none;">
                <h3>ðŸ‘ï¸ Anteprima Dati da Importare</h3>
                <div id="preview-content" class="preview-content"></div>
                <div class="preview-actions">
                    <button class="btn btn-primary" onclick="app.confirmImport()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">check_circle</span>Conferma Importazione</button>
                    <button class="btn btn-secondary" onclick="app.cancelImport()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">cancel</span>Annulla</button>
                    <button class="btn btn-secondary" onclick="app.refineWithAI()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">smart_toy</span>Affina con IA</button>
                </div>
            </div>

            <!-- Imported Documents History -->
            <div class="document-history-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">folder</span>Documenti Importati</h3>
                <div id="imported-documents-list" class="imported-documents-list"></div>
            </div>

            <!-- Audio Recording Section -->
            <div class="audio-recording-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">mic</span>Registrazione Audio Lezione</h3>
                <p class="section-description">Registra le tue lezioni per successive analisi e trascrizioni con l'IA</p>
                <div class="recording-controls">
                    <button class="btn btn-primary" id="start-recording-btn" onclick="app.startAudioRecording()">
                        <span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">mic</span>Avvia Registrazione
                    </button>
                    <button class="btn btn-danger" id="stop-recording-btn" onclick="app.stopAudioRecording()" style="display: none;">
                        â¹ï¸ Ferma Registrazione
                    </button>
                    <div id="recording-timer" class="recording-timer" style="display: none;">
                        â±ï¸ <span id="timer-display">00:00</span>
                    </div>
                </div>
                <div id="recording-status" class="recording-status"></div>
                <div id="recordings-list" class="recordings-list"></div>
            </div>
        </div>

        <!-- Backup & Restore Tab -->
        <div id="backup-restore" class="tab-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">backup</span>Backup & Ripristino</h2>
            <p class="section-description">
                Gestisci i backup dei tuoi dati. Crea backup manuali o programma backup automatici per proteggere le tue informazioni.
            </p>

            <!-- Backup Actions Section -->
            <div class="backup-actions-section">
                <h3>âš¡ Azioni Rapide</h3>
                <div class="backup-actions-grid">
                    <button class="btn btn-primary btn-large" onclick="app.createManualBackup()">
                        <span class="btn-icon">ðŸ“¦</span>
                        <span class="btn-text">Crea Backup Ora</span>
                    </button>
                    <button class="btn btn-secondary btn-large" onclick="app.showRestoreBackupDialog()">
                        <span class="btn-icon">ðŸ“¤</span>
                        <span class="btn-text">Ripristina da File</span>
                    </button>
                </div>
            </div>

            <!-- Scheduled Backup Settings -->
            <div class="backup-settings-section">
                <h3>â° Backup Programmato</h3>
                <div class="form-group">
                    <label for="backup-frequency">Frequenza Backup Automatico:</label>
                    <select id="backup-frequency" onchange="app.updateBackupSchedule()">
                        <option value="never">Mai</option>
                        <option value="daily">Giornaliero</option>
                        <option value="weekly" selected>Settimanale</option>
                        <option value="monthly">Mensile</option>
                    </select>
                    <small>I backup programmati vengono creati automaticamente quando l'app Ã¨ aperta</small>
                </div>
                <div id="backup-schedule-info" class="backup-info"></div>
            </div>

            <!-- Backup List Section -->
            <div class="backup-list-section">
                <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">folder_special</span>Backup Disponibili</h3>
                <div id="backup-list" class="backup-list"></div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>Impostazioni</h2>
            <div class="settings-container">
                <form id="settings-form" onsubmit="event.preventDefault(); app.saveSettings();">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">person</span>Profilo Docente</h3>
                    <div class="form-group">
                        <label for="teacher-first-name">Nome: *</label>
                        <input type="text" id="teacher-first-name" placeholder="Il tuo nome" autocomplete="given-name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-last-name">Cognome: *</label>
                        <input type="text" id="teacher-last-name" placeholder="Il tuo cognome" autocomplete="family-name" required>
                    </div>
                    <div class="form-group">
                        <label for="teacher-email">Email: *</label>
                        <input type="email" id="teacher-email" placeholder="La tua email" autocomplete="email" required>
                    </div>

                    <h3 style="margin-top: 30px;"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">apartment</span>Informazioni Scolastiche</h3>
                    <div class="form-group">
                        <label for="school-level">Ordine di Scuola: *</label>
                        <select id="school-level" required>
                            <option value="">Seleziona ordine di scuola</option>
                            <option value="infanzia">Scuola dell'Infanzia</option>
                            <option value="primaria">Scuola Primaria</option>
                            <option value="secondaria-I">Scuola Secondaria di I Grado</option>
                            <option value="secondaria-II">Scuola Secondaria di II Grado</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="school-name">Nome Scuola:</label>
                        <input type="text" id="school-name" placeholder="Nome della scuola" autocomplete="organization">
                    </div>

                    <h3 style="margin-top: 30px;"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">menu_book</span>Discipline</h3>
                    <div class="form-group">
                        <label for="teacher-subjects-settings">Le tue discipline:</label>
                        <div class="subjects-container">
                            <div id="selected-subjects-display-settings" class="selected-subjects"></div>
                            <input type="text" id="teacher-subjects-settings" placeholder="Scrivi una disciplina e premi Invio">
                            <div id="subjects-suggestions-settings" class="subjects-suggestions"></div>
                        </div>
                        <small>Premi Invio o seleziona dalla lista per aggiungere una disciplina</small>
                    </div>

                    <h3 style="margin-top: 30px;"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">calendar_today</span>Anno Scolastico</h3>
                    <div class="form-group">
                        <label for="school-year">Anno Scolastico: *</label>
                        <select id="school-year" required>
                            <option value="">Seleziona anno scolastico</option>
                            <option value="2024/2025">2024/2025</option>
                            <option value="2025/2026">2025/2026</option>
                            <option value="2026/2027">2026/2027</option>
                            <option value="2027/2028">2027/2028</option>
                            <option value="2028/2029">2028/2029</option>
                        </select>
                        <small>Seleziona l'anno scolastico di riferimento</small>
                    </div>
                    <div class="form-group">
                        <label for="school-year-start">Data Inizio Anno:</label>
                        <input type="date" id="school-year-start">
                        <small>Data di inizio dell'anno scolastico (es. 09/09/2025)</small>
                    </div>
                    <div class="form-group">
                        <label for="school-year-end">Data Fine Anno:</label>
                        <input type="date" id="school-year-end">
                        <small>Data di fine dell'anno scolastico (es. 30/06/2026)</small>
                    </div>

                    <h3 style="margin-top: 30px;"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">smart_toy</span>Integrazione IA</h3>
                    <div class="form-group">
                        <label for="openrouter-api-key">OpenRouter API Key:</label>
                        <div class="api-key-input-container">
                            <input type="password" id="openrouter-api-key" placeholder="Inserisci la tua API key" autocomplete="off">
                            <span id="api-key-status" class="api-key-status" title="Non verificata">âšª</span>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="app.verifyAPIKey()" style="margin-top: 10px;"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">search</span>Verifica API Key</button>
                        <small>La chiave API viene salvata localmente nel browser</small>
                    </div>
                    <div class="form-group">
                        <label for="openrouter-model-id">Model ID:</label>
                        <input type="text" id="openrouter-model-id" placeholder="es. alibaba/tongyi-deepresearch-30b-a3b" autocomplete="off">
                        <small>ID del modello OpenRouter da utilizzare (default: alibaba/tongyi-deepresearch-30b-a3b)</small>
                    </div>

                    <h3 style="margin-top: 30px;"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">smart_toy</span>Agente IA Floating</h3>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ai-fab-enabled" checked>
                            Mostra Agente IA Floating
                        </label>
                        <small>Attiva/disattiva il pulsante dell'agente IA sempre visibile</small>
                    </div>
                    <div class="form-group">
                        <button type="button" class="btn btn-secondary" onclick="app.resetAIFABPosition()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">refresh</span>Ripristina Posizione Agente IA</button>
                        <small>Riporta l'agente IA alla posizione predefinita (in basso a destra)</small>
                    </div>

                    <h3 style="margin-top: 30px;">ðŸŽ¨ Aspetto e AccessibilitÃ </h3>
                    <div class="form-group">
                        <label for="app-theme">Tema:</label>
                        <select id="app-theme" onchange="app.changeTheme(this.value)">
                            <option value="light">â˜€ï¸ Chiaro</option>
                            <option value="dark">ðŸŒ™ Scuro</option>
                        </select>
                        <small>Scegli il tema dell'applicazione</small>
                    </div>

                    <button type="submit" class="btn btn-primary">Salva Impostazioni</button>
                </form>
                <div style="margin-top: 20px;">
                    <button class="btn btn-secondary" onclick="app.exportData()">ðŸ“¥ Esporta Dati</button>
                    <button class="btn btn-secondary" onclick="app.importData()">ðŸ“¤ Importa Dati</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating AI Agent Button -->
    <div id="ai-fab" class="ai-fab" onclick="app.toggleAIAgentModal()" title="Apri Agente IA Contestuale">
        <span class="material-icons" style="font-size: 32px;">smart_toy</span>
    </div>

    <!-- AI Agent Modal for Contextual Analysis -->
    <div id="ai-agent-modal" class="modal" style="display: none;">
        <div class="modal-content ai-agent-content">
            <div class="modal-header">
                <h2 id="ai-agent-modal-title"><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">smart_toy</span>Agente IA - Assistente Contestuale</h2>
                <button class="close-btn" onclick="app.closeAIAgentModal()">âœ•</button>
            </div>
            
            <div class="ai-agent-body">
                <div id="ai-agent-context-info" class="ai-context-info">
                    <p><strong>Sezione corrente:</strong> <span id="ai-current-section">Dashboard</span></p>
                </div>

                <div class="form-group" id="ai-agent-url-group">
                    <label for="ai-agent-news-url">URL News da Analizzare:</label>
                    <input type="url" id="ai-agent-news-url" placeholder="https://esempio.com/news-articolo" />
                    <small>Inserisci l'URL della news per l'analisi contestuale</small>
                </div>

                <div class="form-group">
                    <label for="ai-agent-context">Richiesta per l'Agente IA:</label>
                    <textarea id="ai-agent-context" rows="4" placeholder="es. Aiutami a creare una programmazione didattica per questa settimana"></textarea>
                    <small id="ai-agent-context-help">Specifica cosa vuoi che l'agente faccia nella sezione corrente</small>
                </div>

                <div class="ai-agent-suggestions" id="ai-agent-suggestions">
                    <p><strong>Suggerimenti contestuali:</strong></p>
                    <div id="ai-suggestions-buttons"></div>
                </div>

                <div class="ai-agent-results" id="ai-agent-results" style="display: none;">
                    <h4><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">analytics</span>Risultati Analisi</h4>
                    <div id="ai-agent-results-content"></div>
                    
                    <div class="ai-agent-actions" id="ai-agent-actions" style="display: none;">
                        <h5><span class="material-icons" style="vertical-align: middle; margin-right: 8px; font-size: 20px;">check_circle</span>Azioni Proposte</h5>
                        <div id="ai-agent-proposed-actions"></div>
                    </div>
                </div>

                <div class="form-actions">
                    <button class="btn btn-primary" onclick="app.analyzeNewsWithAI()"><span class="material-icons" style="vertical-align: middle; font-size: 18px; margin-right: 4px;">search</span>Analizza con IA</button>
                    <button class="btn btn-secondary" onclick="app.closeAIAgentModal()">Chiudi</button>
                </div>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('âœ… Service Worker registered successfully:', registration.scope);
                        
                        // Check for updates periodically (every 30 minutes)
                        setInterval(() => {
                            registration.update();
                        }, 1800000); // Check every 30 minutes
                        
                        // Also check for updates when the page becomes visible
                        document.addEventListener('visibilitychange', () => {
                            if (document.visibilityState === 'visible') {
                                registration.update();
                            }
                        });
                        
                        // Listen for updates
                        registration.addEventListener('updatefound', () => {
                            const newWorker = registration.installing;
                            newWorker.addEventListener('statechange', () => {
                                if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                                    // New service worker available, show update notification
                                    if (confirm('Ãˆ disponibile un aggiornamento dell\'app. Vuoi ricaricare?')) {
                                        newWorker.postMessage({ type: 'SKIP_WAITING' });
                                        window.location.reload();
                                    }
                                }
                            });
                        });
                    })
                    .catch((error) => {
                        console.error('âŒ Service Worker registration failed:', error);
                    });
            });
            
            // Handle service worker controller change
            let refreshing;
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                if (refreshing) return;
                refreshing = true;
                window.location.reload();
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing on mobile
            e.preventDefault();
            // Stash the event so it can be triggered later
            deferredPrompt = e;
            
            // Show install button or notification
            console.log('ðŸ’¡ PWA puÃ² essere installata!');
            
            // You can show a custom install button here
            // For now, we'll just log it
            showPWAInstallPrompt();
        });
        
        function showPWAInstallPrompt() {
            // Create a subtle notification for PWA installation
            const installPrompt = document.createElement('div');
            installPrompt.id = 'pwa-install-prompt';
            installPrompt.style.cssText = `
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #4a90e2;
                color: white;
                padding: 15px 25px;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 10000;
                display: flex;
                align-items: center;
                gap: 15px;
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
                animation: slideUp 0.3s ease-out;
            `;
            
            installPrompt.innerHTML = `
                <span><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">phone_android</span>Installa Docente++ sul tuo dispositivo</span>
                <button id="pwa-install-btn" style="
                    background: white;
                    color: #4a90e2;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 4px;
                    font-weight: bold;
                    cursor: pointer;
                ">Installa</button>
                <button id="pwa-dismiss-btn" style="
                    background: transparent;
                    color: white;
                    border: 1px solid white;
                    padding: 8px 16px;
                    border-radius: 4px;
                    cursor: pointer;
                ">Dopo</button>
            `;
            
            // Add animation
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from {
                        transform: translateX(-50%) translateY(100px);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(installPrompt);
            
            // Install button click
            document.getElementById('pwa-install-btn').addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    console.log(`User response to install prompt: ${outcome}`);
                    deferredPrompt = null;
                }
                installPrompt.remove();
            });
            
            // Dismiss button click
            document.getElementById('pwa-dismiss-btn').addEventListener('click', () => {
                installPrompt.remove();
            });
            
            // Auto-dismiss after 10 seconds
            setTimeout(() => {
                if (installPrompt.parentNode) {
                    installPrompt.remove();
                }
            }, 10000);
        }
        
        // Track when the app is installed
        window.addEventListener('appinstalled', () => {
            console.log('âœ… PWA installata con successo!');
            deferredPrompt = null;
        });
    </script>
    
    <!-- Class Selector Modal -->
    <div id="class-selector-modal" class="modal" style="display: none;">
        <div class="modal-content class-selector-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">school</span>Seleziona Classe Attiva</h2>
            <p>Scegli la classe su cui lavorare oppure Workspace per vedere tutti i dati aggregati:</p>
            
            <div class="class-selector-list" id="class-selector-list">
                <!-- Will be populated by app.showClassSelector() -->
            </div>
            
            <div class="form-actions">
                <button class="btn btn-secondary" onclick="app.closeClassSelector()">Chiudi</button>
            </div>
        </div>
    </div>
    
    <!-- App Info Modal -->
    <div id="app-info-modal" class="modal" style="display: none;">
        <div class="modal-content app-info-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">info</span>Informazioni su Docente++</h2>
            <div class="app-info-details">
                <p><strong>Versione:</strong> 2.0.0</p>
                <p><strong>Ultima Modifica:</strong> Ottobre 2025</p>
                <p><strong>Descrizione:</strong> Web app per la gestione della didattica dell'insegnante potenziata da IA OpenRouter</p>
                <p><strong>Caratteristiche principali:</strong></p>
                <ul>
                    <li>Gestione lezioni, studenti e classi</li>
                    <li>Orario settimanale interattivo</li>
                    <li>Assistente IA per supporto didattico</li>
                    <li>Backup e ripristino dati</li>
                    <li>PWA installabile</li>
                </ul>
                <p><strong>Sviluppato da:</strong> antbrogame-a11y</p>
                <p><strong>Licenza:</strong> Open Source</p>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="app.closeAppInfo()">Chiudi</button>
            </div>
        </div>
    </div>
    
    <!-- Help Modal -->
    <div id="help-modal" class="modal" style="display: none;">
        <div class="modal-content help-content">
            <h2><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">help</span>Guida Rapida</h2>
            <div class="help-sections">
                <div class="help-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">home</span>Sala Prof</h3>
                    <p>La dashboard principale con l'orario del giorno e accesso rapido alle funzionalitÃ  principali.</p>
                </div>
                <div class="help-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">school</span>Classe Attiva</h3>
                    <p>Seleziona la classe su cui lavorare. Scegli "Workspace" per vedere tutti i dati aggregati di tutte le classi.</p>
                </div>
                <div class="help-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">apps</span>Gestione</h3>
                    <p>Accedi alle funzionalitÃ  operative: studenti, classi, lezioni, orario, valutazioni, attivitÃ  e assistente IA.</p>
                </div>
                <div class="help-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">settings</span>Impostazioni</h3>
                    <p>Configura l'app, gestisci backup e notifiche.</p>
                </div>
                <div class="help-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">event</span>Orario di Oggi</h3>
                    <p>Visualizza l'orario del giorno corrente. Clicca su una cella per modificare l'attivitÃ . L'orario si adatta automaticamente alla classe selezionata.</p>
                </div>
                <div class="help-section">
                    <h3><span class="material-icons" style="vertical-align: middle; margin-right: 8px;">lightbulb</span>Suggerimenti</h3>
                    <ul>
                        <li>Usa i tooltip (passa il mouse sopra le icone) per sapere cosa fanno i pulsanti</li>
                        <li>Il badge in alto mostra sempre la classe attiva corrente</li>
                        <li>L'orario Ã¨ interattivo: tocca le celle per modificare</li>
                        <li>Workspace mostra i dati aggregati di tutte le classi</li>
                    </ul>
                </div>
            </div>
            <div class="form-actions">
                <button class="btn btn-primary" onclick="app.closeHelp()">Chiudi</button>
            </div>
        </div>
    </div>

    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTopBtn" title="Torna su" aria-label="Torna su">
        <span class="material-icons">arrow_upward</span>
    </button>
</body>
</html>
