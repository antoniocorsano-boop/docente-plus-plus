<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Test Activity Import Logic</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .result { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .pass { background-color: #d4edda; border: 1px solid #c3e6cb; }
        .fail { background-color: #f8d7da; border: 1px solid #f5c6cb; }
        pre { background-color: #f1f1f1; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>Test for Correct Activity Import Logic</h1>
    <div id="results"></div>

    <script src="app.js"></script>
    <script>
        // Helper to run a test
        function runTest(testName, testFunction) {
            const resultsDiv = document.getElementById('results');
            let result = { pass: false, message: '' };
            try {
                testFunction();
                result = { pass: true, message: 'Test passed!' };
            } catch (e) {
                result = { pass: false, message: `Test failed: ${e.message}` };
            }

            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${result.pass ? 'pass' : 'fail'}`;
            resultDiv.innerHTML = `<strong>${testName}:</strong> ${result.message}`;
            resultsDiv.appendChild(resultDiv);
        }

        // --- Test Scenario ---
        runTest('Activity Import Test', () => {
            // 1. Create a mock app instance
            const app = new DocentePlusPlus();

            // 2. Setup initial state
            app.classes = [
                { id: 1, name: '1A', year: '1' },
                { id: 2, name: '1B', year: '1' },
                { id: 3, name: '2A', year: '2' }
            ];

            app.currentImportData = {
                activitiesData: [
                    { title: 'Attività per la prima 1', type: 'exercise', classLevel: 'Prima' },
                    { title: 'Attività per la seconda', type: 'project', classLevel: 'Seconda' },
                    { title: 'Attività generale', type: 'lab', classLevel: 'Generale' }
                ],
                file: { name: 'piano_didattico.pdf' }
            };

            // 3. Run the function to be tested
            app.confirmActivitiesImport();

            // 4. Assertions
            if (app.activities.length !== 3) {
                throw new Error(`Expected 3 activities to be created, but found ${app.activities.length}. No duplicates should be created.`);
            }

            const primaActivity = app.activities.find(a => a.title === 'Attività per la prima 1');
            if (!primaActivity || primaActivity.classLevel !== 'Prima') {
                throw new Error(`Activity for 'Prima' was not created with the correct classLevel.`);
            }
            if (primaActivity.classId !== null) {
                throw new Error(`Activity for 'Prima' should have a null classId, but found ${primaActivity.classId}.`);
            }

            const secondaActivity = app.activities.find(a => a.title === 'Attività per la seconda');
            if (!secondaActivity || secondaActivity.classLevel !== 'Seconda') {
                throw new Error(`Activity for 'Seconda' was not created with the correct classLevel.`);
            }

            const generaleActivity = app.activities.find(a => a.title === 'Attività generale');
            if (!generaleActivity || generaleActivity.classLevel !== 'Generale') {
                throw new Error(`Activity for 'Generale' was not created with the correct classLevel.`);
            }
        });
    </script>
</body>
</html>