name: Create resources
on:
  push:
    branches:
      - main

jobs:
  create-resources:
    name: Create resources
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Create GitHub proj via API
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          # Metti qui i nomi dei progetti separati da |, es: "Progetto A|Progetto B"
          PROJECT_LIST: "Progetto A|Progetto B"
        run: |
          set -euo pipefail
          IFS='|' read -ra PROJECTS <<< "$PROJECT_LIST"
          OWNER=$(echo "$GITHUB_REPOSITORY" | cut -d'/' -f1)
          REPO=$(echo "$GITHUB_REPOSITORY" | cut -d'/' -f2)
          for p in "${PROJECTS[@]}"; do
            p_trimmed="$(echo "$p" | sed 's/^[[:space:]]*//; s/[[:space:]]*$//')"
            echo "Creazione progetto: '$p_trimmed' in $OWNER/$REPO"
            payload=$(printf '{"name":"%s","body":"Creato da workflow"}' "$p_trimmed")
            resp=$(curl -s -X POST \
              -H "Authorization: Bearer $GITHUB_TOKEN" \
              -H "Accept: application/vnd.github+json" \
              "https://api.github.com/repos/$OWNER/$REPO/projects" \
              -d "$payload")
            echo "$resp"
          done
